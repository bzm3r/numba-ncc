from __future__ import division
import numpy as np
import general.exec_utils as eu
import general.experiment_templates as ets
import core.utilities as cu
import visualization.datavis as datavis
import os

scriptname = os.path.basename(__file__)[:-3]
DATE_STR, EXPERIMENT_NUMBER = eu.get_date_and_experiment_number(scriptname)

base_parameter_dict = dict([('halfmax_coa_sensing_dist_multiplier', 4.4), ('kdgdi_rac_estimate_multiplier', 0.2), ('kdgdi_rho_estimate_multiplier', 0.2), ('kgdi_rac_estimate_multiplier', 1), ('kgdi_rho_estimate_multiplier', 1), ('kdgtp_rac_mediated_rho_inhib_multiplier', 500), ('kdgtp_rac_multiplier', 20), ('kdgtp_rho_mediated_rac_inhib_multiplier', 3000), ('kdgtp_rho_multiplier', 20), ('kgtp_rac_autoact_multiplier', 250), ('kgtp_rac_multiplier', 20), ('kgtp_rho_autoact_multiplier', 125), ('kgtp_rho_multiplier', 20), ('max_protrusive_node_velocity', 1e-06), ('randomization', False), ('randomization_scheme', 'wipeout'), ('randomization_time_mean', 20), ('randomization_time_variance_factor', 0.25), ('randomization_magnitude', 1.0), ('sigma_rac', 2e-05), ('sigma_rho_multiplier', 0.2), ('force_adh_constant', 1.0), ('force_rac_exp', 3), ('force_rho_exp', 3), ('force_rac_threshold_multiplier', 0.5), ('force_rho_threshold_multiplier', 0.5), ('skip_dynamics', False), ('stiffness_cytoplasmic', 1e-1), ('stiffness_edge', 5e-10), ('tension_fn_type', 0), ('tension_mediated_rac_hill_exponent', 3), ('tension_mediated_rac_inhibition_half_strain', 0.05), ('threshold_rac_autoact_multiplier', 0.5), ('threshold_rac_mediated_rho_inhib_multiplier', 0.5), ('threshold_rho_autoact_multiplier', 0.5), ('threshold_rho_mediated_rac_inhib_multiplier', 0.5), ('coa_sensitivity_percent_drop_over_cell_diameter', 0.25), ('coa_belt_offset_multiplier', 1.5)])

parameter_override_dict = eu.update_pd_with_keyvalue_tuples(base_parameter_dict, [('halfmax_coa_sensing_dist_multiplier', 4.4, 4.4), ('kdgdi_rac_estimate_multiplier', 0.2, 1.0*0.2), ('kdgdi_rho_estimate_multiplier', 0.2, 1.0*0.2), ('kgdi_rac_estimate_multiplier', 1, 1.0), ('kgdi_rho_estimate_multiplier', 1, 1), ('kdgtp_rac_mediated_rho_inhib_multiplier', 500, 800), ('kdgtp_rac_multiplier', 20, 20*(2/3.)), ('kdgtp_rho_mediated_rac_inhib_multiplier', 3000, 500), ('kdgtp_rho_multiplier', 20, 20*(2/3.)), ('kgtp_rac_autoact_multiplier', 250, 100), ('kgtp_rac_multiplier', 20, 20), ('kgtp_rho_autoact_multiplier', 125, 200), ('kgtp_rho_multiplier', 20, 20), ('max_protrusive_node_velocity', 1e-06, 0.75*0.25e-6), ('randomization', False, False), ('randomization_scheme', 'wipeout', 'kgtp_rac_multipliers'), ('randomization_time_mean', 20, 15), ('randomization_time_variance_factor', 0.25, 0.5), ('randomization_magnitude', 1.0, 10), ('sigma_rac', 2e-05, 3.2e-05), ('sigma_rho_multiplier', 0.2, 0.2), ('force_adh_constant', 1.0, 0.5), ('force_rac_exp', 3, 3), ('force_rho_exp', 3, 3), ('force_rac_threshold_multiplier', 0.5, 0.9*1.75), ('force_rho_threshold_multiplier', 0.5, 0.9*1.75), ('skip_dynamics', False, False), ('stiffness_edge', 5e-10, 0.75*3.8e-10), ('tension_fn_type', 0, 7), ('tension_mediated_rac_inhibition_half_strain', 0.05, 0.05*0.6), ('threshold_rac_autoact_multiplier', 0.5, 0.5), ('threshold_rac_mediated_rho_inhib_multiplier', 0.5, 0.5), ('threshold_rho_autoact_multiplier', 0.5, 0.3), ('threshold_rho_mediated_rac_inhib_multiplier', 0.5, 0.5), ('coa_sensitivity_percent_drop_over_cell_diameter', 0.25, -1), ('coa_belt_offset_multiplier', 1.5, 1.5)])

num_experiment_repeats = 3

ets.single_cell(DATE_STR, EXPERIMENT_NUMBER, base_parameter_dict, parameter_override_dict, randomization=True, base_output_dir="C:\\cygwin\\home\\Brian Merchant\\numba-ncc\\output\\", total_time_in_hours=3, timestep_length=2, num_nodes=16, cell_diameter=40, verbose=True, closeness_dist_squared_criteria=(1e-6)**2, integration_params={'rtol': 1e-4}, max_timepoints_on_ram=10, default_coa=0, default_cil=0, num_experiment_repeats=num_experiment_repeats, produce_intermediate_visuals=np.array([]), produce_final_visuals=True, full_print=True, delete_and_rerun_experiments_without_stored_env=True)
